name: npm audit

on:
  pull_request:
  push:
    branches:
      - master
# on:
#   schedule:
#     - cron: '0 10 * * *'

jobs:
  scan:
    name: npm audit
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - id: installandcheck
        name: install dependencies
        continue-on-error: true
        run: |
          npm i
          npm i axios@0.21.0
          npm audit --audit-level=high --json >> auditoutput.txt
      - id: issue
        name: create github issue
        env:
          STEPS_CONTEXT: ${{ toJSON(steps) }}
        if: steps.installandcheck.outcome != 'success'
        run: |
          echo "$STEPS_CONTEXT"
          cat auditoutput.txt
          echo "auditoutput=$(cat auditoutput.txt)"
          curl 'https://api.github.com/repos/Himavanth/hima/issues?labels=bug' > curloutput.txt
          cat curloutput.txt
      - id: noissue
        name: dont create github issue
        env:
          STEPS_CONTEXT: ${{ toJSON(steps) }}
        if: steps.installandcheck.outcome == 'success'
        run: |
          echo "all good"


